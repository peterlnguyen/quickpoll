// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var append_choice, bind_append, bind_next, bind_previous, current_choice, current_id, extract_fields, has_duplicates, has_errors;
    current_choice = 5;
    current_id = "#choice5";
    bind_append = function(identifier) {
      return $(identifier).blur(function() {
        return bind_next(identifier);
      });
    };
    bind_next = function(identifier) {
      $(current_id).unbind();
      current_choice++;
      current_id = "#choice" + current_choice;
      append_choice();
      bind_append(current_id);
      console.log("current_choice: ", current_choice);
      if ($(identifier).val() === "" && current_choice > 5) {
        return bind_previous();
      }
    };
    bind_previous = function() {
      console.log("appended: ", $("#appended" + current_choice));
      $("#appended" + current_choice).unbind();
      $("#appended" + current_choice).remove();
      current_choice--;
      current_id = "#choice" + current_choice;
      return bind_append(current_id);
    };
    append_choice = function() {
      return $("#choice-list").append('\
      <div id="appended' + current_choice + '">\
        <label> Choice ' + current_choice + ':</label>\
        <input type="text" name="choices" id="choice' + current_choice + '" class="choices">\
      </div>\
    ');
    };
    bind_append(current_id);
    extract_fields = function(form) {
      var values;
      values = {};
      form.each(function() {
        return values[this.name] = $(this).val();
      });
      return values;
    };
    has_errors = function(inputs) {
      var error_flag, key, value, _i, _len;
      error_flag = false;
      for (key = _i = 0, _len = inputs.length; _i < _len; key = ++_i) {
        value = inputs[key];
        if (value === "") {
          error_flag = true;
        }
      }
      return error_flag;
    };
    $("#pollSubmit").click(function() {
      var inputs;
      inputs = extract_fields($("#pollForm :input"));
      if (has_errors(inputs)) {
        return console.log("input errors!");
      } else if (has_duplicates(".choices")) {
        return console.log("duplicate errors!");
      } else {
        console.log("no errors!");
        return $("#pollForm").submit();
      }
    });
    return has_duplicates = function(identifier) {
      var choices, duplicate_flag;
      choices = {};
      duplicate_flag = false;
      $("" + identifier).each(function() {
        var value;
        value = $(this).val();
        if (choices[value] && value === !"") {
          return duplicate_flag = true;
        } else {
          return choices[value] = "foobar";
        }
      });
      return duplicate_flag;
    };
  });

}).call(this);
